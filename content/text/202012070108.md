## Next.js でブログをつくった

最近フロントエンドのコードを書いてないな・・・と思って、今までに身につけた知識の棚卸しも兼ねてブログをつくってみました。

### 使用した技術スタックなど

この章は別記事で図も交えながら書き残したいなと思ってます。ので、今回は軽めに。

#### フロント

- Next.js（SSG）
  - TypeScript で書いています。ただし、 any で逃げている箇所がまだ割とあります・・・
- remark, remark-html
  - .md ファイルで入稿したものを読み込み、 html 形式にパースして記事コンポーネント内に挿入しています。
- Chakra UI
  - ブログ全体のスタイリングに使用しています。
    - Material UI は飽きた・・・というか、雑に使うとすぐに「はいはい、また Material UI ね」ってすぐバレてしまうのが嫌でこちらを採用しました。
      - いつかの Github Trend で見かけたのが採用のきっかけです。日本語情報があまりありませんが、ドキュメントやそもそものライブラリの使い方がわかりやすく、気に入っています。

#### バックエンド

- DynamoDB
  - 記事のメタデータを管理するのに使用
    - 他の JS フレームワークを使用したブログだと、 frontmatter という形式で .md ファイル内にメタデータを書き込んだものを取り出してオブジェクト化したものをメタデータとして扱っている事例が多いですが、自分の場合、データベースにメタ情報を外出しして色んなことに使いたいなーと思ったのでこうしました。
- Github Actions
  - 入稿した記事のメタデータファイル（.toml）を S3 に連携したり、PR のマージ時にソースをビルドしてブログをホストしている S3 バケットへデプロイさせたりしています。
- S3, Lambda
  - 記事のホスティングや、メタデータ置き場に使っています。Lambda は、メタデータ置き場のバケットのファイル作成通知で発火し、 メタデータを DynamoDB レコードへ変換して PUT するのに使っています。
    - ちなみに Lambda は Python で書いています。他言語と比べて、記述量が少なくすみ、直感的に書いてもコードが（見た目的に）汚くなりづらいので、書いていて楽しかったです。
- AWS SDK
  - S3, Lambda の設定やリソースのデプロイをコード化するのに使っています。
    - CFn や SAM が .yaml 形式でテンプレートファイルを作成するのに対して、こちらは TypeScript などのいわゆるプログラミング言語で記述できるのが特徴です。ググってでてくる解説記事はほぼ TypeScript な気がします。
      - 書けばわかるのですが、めちゃくちゃ補完や校正が効いてサクサク書けるので書いてて楽しいです。これは本当にすごい・・・

### これから取り入れていきたい技術や機能など

諸事情により、だいぶ急いで形になるように持っていったので色んな所がガタついていたり足りていなかったりしているのが現状です。

- AppSync(GraphQL)

  - 元々このブログを作成した当初は、 Amplify を使用して DynamoDB への接続を管理していたのですが、 Amplify が CFn スタックを作ってしまうこと、GraphQL や AppSync 関連の設定ファイルを Amplify CLI で管理しなければならないこと、などを考慮して Amplify ごと色々はがしてしまっています。
    - どちらに関しても、AWS リソースについては AWS CDK に管理をまとめたかった事情があり、ここの作り込みを今やってしまうとブログが完成せず記事を書き始めるのも遅れてしまう・・・と思ったので、一時撤退しています（現状は、AWS SDK から直で DynamoDB に接続しています）。

- カテゴリ検索・タグ検索・全文検索

  - 前 2 者はやろうと思えばすぐにできそうですが、現状、記事数的になくてもしばらくはなんとかなりそうということで後回しにしています。
    - 全文検索は・・・どうやろうから考えるところからなので、実現は当分あとになりそうです。

- 記事情報の完全外部化

  - 現状の入稿フローだと、記事を書くたびにブランチを切ってプッシュして PR 出してマージして・・・とフローが煩雑なので、ブログ自体のリソースと記事リソースは別の管理フローにしたいなと思っています。
    - S3 sync でバケットに記事入稿して、それをトリガーに Lambda が Github Actions のビルドワークフローをキックして・・・とかできないかな、とか。

- リファクタリング

  - デザインがいまいちいけてないのと、コンポーネントの組み合わせが DRY に反している箇所がだいぶあるので直したい・・・
    - シンタックスハイライトに対応していないのがけっこうまずいかなと思ってます

- 目次がほしい

  - 目次めっちゃほしいです。ただ、どうやってつくるんだろう・・・

- 解析用のもろもろ準備
  - GA とか今ちゃんと使えてるのか謎です。あとロギング・モニタリングをまじめにやらないと・・・

### ここまでの開発を振り返ってみて

とにかくめちゃくちゃググったのでブラウザのタブがえらいことになっています（現在進行系）。まあ、それだけの知識をインターネットから又借りできたということなので、やはりインターネットは偉大ですね。

- 特に参考にしたページ
  - 配列の重複を削除・抽出する｜ Python
    - [https://www.suzu6.net/posts/97-python-duplication/](https://www.suzu6.net/posts/97-python-duplication/)
    - `重複要素の抽出` の章を参考にしました。Python、こういう処理をこう簡潔にかけて美しいですね
  - git reset --hard した内容を取り消す (git reset --hard, reflog, HEAD@{x}, 取り消してしまったコミットを元に戻す)
    - [https://devlights.hatenablog.com/entry/20121121/p1](https://devlights.hatenablog.com/entry/20121121/p1)
    - 寝ぼけてやらかしてしまったときに掴んだ記事です。あるあるなんでしょうが、冷や汗をかきました。業務のソースでやらかさないで今やっといてよかったです。
  - AWS CDK の記事一覧 | Developers.IO
    - [https://dev.classmethod.jp/tags/aws-cdk/](https://dev.classmethod.jp/tags/aws-cdk/)
    - クラメソさんの AWS CDK 記事一覧です。さすがの充実ぶり！めっちゃ参考にしました。
  - AWS CDK で Lambda をデプロイしてみた。Layer 付き。 - アクトインディ開発者ブログ
    - [https://tech.actindi.net/2019/12/03/084108](https://tech.actindi.net/2019/12/03/084108)
    - Lambda Layer を利用した Lambda デプロイに関しては、こちらの記事が簡潔にまとまったてよかったです。
  - Gatsby + TypeScript で技術ブログを書くための知見
    - [https://blog.ojisan.io/1st-blog-stack](https://blog.ojisan.io/1st-blog-stack)
    - SSG でブログを作るきっかけになった記事です。他の記事や、筆者の方の Github のソースコードもめっちゃ参考にしています。

他にもたくさんの記事を読ませていただいています。ありがとうございます。自分も誰かの知識になるような記事を書きたいですね・・・。

### それではいったん、今回はここまで
